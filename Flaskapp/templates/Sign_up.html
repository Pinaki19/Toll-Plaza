<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,700" rel="stylesheet">
    <title>Sign up</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css" rel="stylesheet" />
    <link rel="stylesheet" type= "text/css" href= "{{ url_for('static',filename='css/Sign_up.css') }}">
    <script src="{{ url_for('static',filename='js/scripts.js') }}"></script>
</head>

<body>
    
    <nav class="navbar navbar-expand-lg navbar-dark" style="background-color:#000;">
        <div class="container-fluid">
            <a href="#" class="navbar-brand">Toll System</a>
            <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
            <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-between" id="navbarCollapse">
                <div class="navbar-nav">
                    <a href="/" class="nav-item nav-link active">Home</a>
                    <a href="/profile" class="nav-item nav-link">Profile</a>
                    <div class="nav-item dropdown">
                        <a href="#Messages" id='MessagesToggle' class="nav-link dropdown-toggle" data-bs-toggle="dropdown">Messages</a>
                    <div class="dropdown-menu">
                        <a href="#" class="dropdown-item">Notifications</a>
                        <a href="#Query" class="dropdown-item" id='Query'>Ask a Query</a>
                    </div>
                    </div>
                </div>
                
                <div class="navbar-nav">
                    <a href="/Log_in" class="nav-item nav-link" style="padding-right:30px">Login</a>
                    <form class="d-flex"style="padding-right:30px" >
                    <div class="input-group" style="padding-top:5px; padding-right:20px;">
                        <input type="text" class="form-control" placeholder="Search" id="Search_bar" required>
                        <button type="submit" class="btn btn-secondary" onclick="search()"><i class="bi-search"></i></button>
                    </div>
                </form>
                </div>
            </div>
        </div>
    </nav>
    <div class="signup-form">
        <form id="form">
            <h2>Smooth Sailing Portal</h2>
            <p>Please fill in this form to create an account!</p>
            <hr>
            <div class="form-group">
                
                <div class="input-group">
                    <span class="input-group-addon"><i class="fa fa-user"></i></span>
                    <input type="text" class="form-control" id="username" name="username" placeholder="Username" required="required">
                </div>
            </div>
            <div class="form-group">
                <div class="input-group">
                    <span class="input-group-addon"><i class="fa fa-paper-plane"></i></span>
                    <input type="email" class="form-control" id="email" name="email" placeholder="Email Address"
                        required="required">
                </div>
            </div>
            <div class="form-group">
                <div class="input-group">
                    <span class="input-group-addon"><i class="fa fa-lock"></i></span>
                    <input type="password" class="form-control" id="password" name="password" placeholder="Password" required="required" oninput="check_pass()">
                    <i class="bi bi-eye-slash-fill" id="eye"  onclick="show_hide()" ></i>
                </div>
                
            </div>
            <div class="form-group">
                <div class="input-group">
                    <span class="input-group-addon">
                        <i class="fa fa-lock"></i>
                        <i class="fa fa-check"></i>
                    </span>
                    <input type="text" class="form-control" id="confirm_password" name="confirm_password" placeholder="Confirm Password"
                        required="required" oninput="check_pass()">
                        <i id="Right_wrong"></i>
                </div>  
            </div>
            <div class="form-group" >
                <label class="checkbox-inline"><input type="checkbox" required="required"> I accept the <a
                        href="#">Terms of Use</a> &amp; <a href="#">Privacy Policy</a></label>
            </div>
            <div class="form-group">
                <button type="submit" class="btn btn-primary btn-lg" id="Sign-up">Sign Up</button>
            </div>
            <div class="text-center" style="color:rgb(32, 217, 165)">Already have an account? 
                <a href="/Log_in"><button type="button" class="btn btn-primary btn-md" id="Login">Login Here</button></a></div>
        </form>
        
    </div>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</body>
<script type="module">
    
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-analytics.js";
    import { getAuth, sendEmailVerification, sendSignInLinkToEmail, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut} from "https://www.gstatic.com/firebasejs/9.10.0/firebase-auth.js";
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyAAJ4Cv2d6cSSbRmnWQPll4kG4TvjdF-W8",
            authDomain: "smooth-sailing-ad0d5.firebaseapp.com",
            projectId: "smooth-sailing-ad0d5",
            storageBucket: "smooth-sailing-ad0d5.appspot.com",
            messagingSenderId: "62968749843",
            appId: "1:62968749843:web:3bbe8560b1e73c0a3244e6",
            measurementId: "G-E6EFBYWRML"
        };
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    console.log(app);
    //----- New Registration code start	  
    document.getElementById("Sign-up").addEventListener("click", async function () {
        var forms = document.getElementById('form');
        var result = forms.checkValidity();
        if (result == false)
            return;
        event.preventDefault();
        var email = document.getElementById("email").value;
        var password = document.getElementById("password").value;
        var username = document.getElementById("username").value;
        var confirm_password = document.getElementById("confirm_password").value;
        if (password != confirm_password) {
            alert("Passwords do not match!.");
            return;
        }

        //For new registration

        event.preventDefault();
        const auth = getAuth();
        try {
            const userCredential = await createUserWithEmailAndPassword(auth, email, password);
            // Signed in
            const user = userCredential.user;
            console.log(user);
            console.log(auth.currentUser);

            await sendEmailVerification(auth.currentUser);

            await register(username, email);
            alert("Success! Email verification sent");
            window.location.href='/Log_in';
            // ...
        } catch (error) {
            const errorMessage = error.message;
            console.log(errorMessage);
            alert(error);
        }
    });
  //----- End


</script>
<script>
    function show_hide(){
        var element=document.getElementById("password");
        var element_type=element.getAttribute("type");
        if(element_type=="password"){
            element.setAttribute("type","text");
            document.getElementById("eye").setAttribute("class","bi bi-eye-fill");
        }
        else{
            element.setAttribute("type", "password");
            document.getElementById("eye").setAttribute ("class","bi bi-eye-slash-fill");
        }
    }

    async function register(username,email){
        
        var requestBody = {
            Name:username,
            Email:email.toLowerCase(),
        };
        var content = JSON.stringify(requestBody);

        await fetch("http://127.0.0.1:8080/Register", {
            method: "POST",
            headers: {
                'Content-Type': 'application/json'
            },
            body: content,
        })
            .then((response) => console.log(response.json()))
            .then((data) => {
                console.log("Response from server:", data);
            })
            .catch((error) => {
                console.error("Error:", error);
                alert(error);
                
            }); 
        
    }

    function check_pass(){
       
        var pass= document.getElementById("password").value;
        var d= document.getElementById("Right_wrong");
        
        if((pass.length===0 && document.getElementById('confirm_password').value.length===0)|| document.getElementById('confirm_password').value.length === 0 ){
            d.removeAttribute('class');
        }else if(pass===document.getElementById('confirm_password').value){
            d.setAttribute("class", "bi bi-check-circle-fill");
        }else{
            d.setAttribute("class", "bi bi-x-circle-fill");
        }
    }
   

</script>


</html>